<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.wizbrain.tbn.statistic.mapper.StatisticMapper">
<!-- 
수정일           수정자         수정내용 
========= ======= ================================================= 
2020.07.23 정다빈     최초 생성 
-->

	<!-- 제보유형 대제목 -->
<select id="selectRpt" parameterType="optRptVo" resultType="record">
		SELECT 
			BAS_LCOD as PARENT_CODE
			,BAS_SCOD AS CODE
			,BAS_NAME AS CODE_NAME
			,F_COLOR
			,F_NAME
			,B_COLOR
			,B_NAME
		FROM CODE_REPORT_TYPE
		where BAS_LCOD='100'
</select>

	<!-- 제보수단 대제목 -->
<select id="selectRtt" resultType="record">
		SELECT 
			'600' AS PARENT_CODE
			,ID AS CODE
			,NAME AS CODE_NAME
		FROM CODE_REPORTMEAN_TYPE
</select>

	<!-- 제보자별 대제목 -->
<select id="selectInfrm" parameterType="optRptVo" resultType="record">
		SELECT 
			'200' AS PARENT_CODE
			,TYPE_ID AS CODE
			,TYPE_NAME AS CODE_NAME
		FROM CODE_INFORMER_TYPE
</select>

	<!-- 제보자별 대제목 -->
<select id="selectArea" parameterType="optAreaVo" resultType="record">
		SELECT 
		'500', 
		AREA_CODE as CODE, 
		AREA_NAME as CODE_NAME
		FROM CODE_AREACODE
</select>


      <!-- 월별 제보 건수 -->
     <resultMap type="statVo" id="getReceiptCntList">
		<result property="monthVar" column="MONTH_VAR"/>
		<result property="stateDt" column="STATE_DT"/>
		<result property="stateCnt" column="STATE_CNT"/>
	</resultMap>
    <select id="getReceiptCntList" parameterType="statVo" resultMap="getReceiptCntList">
		SELECT B.MONTH_VAR, nvl(A.STATE_YEAR,${stateDt}) as STATE_DT, NVL(A.mon_cnt, 0) MON_CNT
		  FROM (
		        SELECT ind_id, SUBSTR(stat_mon, 0, 4) STATE_YEAR, SUBSTR(stat_mon, 5, 6) STATE_MONTH, mon_cnt
		          FROM stat_tbn_monrpt
		         WHERE 1 = 1
		         <if test="indId != null">
                   AND ind_id = ${indId}
		         </if>
		           AND SUBSTR(stat_mon, 0, 4) = ${stateDt}
		       ) A RIGHT OUTER JOIN 
		       <![CDATA[
               (SELECT LPAD(LEVEL, 2,'0') MONTH_VAR FROM DUAL CONNECT BY LEVEL <= 12) B
               ]]>
		 ON A.STATE_MONTH = B.MONTH_VAR
		 WHERE 1 = 1
		 ORDER BY B.MONTH_VAR ASC
    </select>
    
    <!--★★★★★★ 1 & 5: 제보자별 전체건수  -->
	<select id="informerTypeAll" parameterType="params" resultType="record">
	 SELECT 
	 TT.CODE,SUM(TT.CNT) CNT 
	 FROM   
 	 (    	
	SELECT A.CODE, NVL(B.CNT,0) CNT
	FROM 
	(SELECT TYPE_ID AS CODE FROM CODE_INFORMER_TYPE) A
		LEFT OUTER JOIN
			( SELECT INFORMER_TYPE, ALL_CNT + O_ALL_CNT CNT
				FROM STAT_INFRM_TYPE
				WHERE 1=1
				AND REGION_ID = #{REGION_ID}
	<choose>
	    <when test="start_date !=null and start_date neq ''">
			AND SUBSTR(STAT_DATE,0,6) = #{start_date}
		</when>
		<otherwise>
			AND SUBSTR(STAT_DATE,0,6) BETWEEN to_char(add_months(sysdate,-1),'yyyymmdd') AND to_char(SYSDATE,'yyyymmdd')
		</otherwise>
	</choose>
			) B
		ON A.CODE=B.INFORMER_TYPE
	)TT
    GROUP BY TT.CODE
    ORDER BY TT.CODE 
	</select>
	<!--★★★★★★ 1 & 5: 제보자별 자국/타국 전체건수-->
	<select id="informerTypeOurOther" parameterType="params" resultType="record">
	 SELECT 
	 TT.CODE, TT.REGION_ID,SUM(TT.CNT) CNT 
	 FROM   
 	 (    
		SELECT T_CODE.CODE, NVL(T_CNT.REGION_ID,#{REGION_ID}) REGION_ID, NVL(T_CNT.CNT,0) CNT
		FROM 
		(SELECT TYPE_ID AS CODE FROM CODE_INFORMER_TYPE) T_CODE
			LEFT OUTER JOIN
				(SELECT A.REGION_ID,  A.INFORMER_TYPE, A.ALL_CNT CNT
				FROM STAT_INFRM_TYPE A
				WHERE 1=1
		<choose>
			<when test="start_date !=null and start_date neq ''">
				AND SUBSTR(STAT_DATE,0,6) = #{start_date}
			</when>
			<otherwise>
				AND SUBSTR(STAT_DATE,0,6) BETWEEN to_char(add_months(sysdate,-1),'yyyymmdd') AND to_char(SYSDATE,'yyyymmdd')
			</otherwise>
		</choose>
				AND A.REGION_ID = #{REGION_ID}
				) T_CNT
			ON T_CODE.CODE=T_CNT.INFORMER_TYPE
		
		UNION ALL
		
		SELECT T_OCODE.CODE, NVL(T_OCNT.REGION_ID,'000') REGION_ID, NVL(T_OCNT.CNT,0) CNT
		FROM 
		(SELECT TYPE_ID AS CODE FROM CODE_INFORMER_TYPE) T_OCODE
			LEFT OUTER JOIN
				(SELECT '000' REGION_ID, A.INFORMER_TYPE, A.O_ALL_CNT CNT
				FROM STAT_INFRM_TYPE A
				WHERE 1=1
		<choose>
			<when test="start_date !=null and start_date neq ''">
				AND SUBSTR(STAT_DATE,0,6) = #{start_date}
			</when>
			<otherwise>
				AND SUBSTR(STAT_DATE,0,6) BETWEEN to_char(add_months(sysdate,-1),'yyyymmdd') AND to_char(SYSDATE,'yyyymmdd')
			</otherwise>
		</choose>
				AND A.REGION_ID = #{REGION_ID}
				) T_OCNT
			ON T_OCODE.CODE=T_OCNT.INFORMER_TYPE
    )TT
    GROUP BY TT.CODE,TT.REGION_ID
    ORDER BY TT.CODE, TT.REGION_ID DESC
	</select>
	
	<!--★★★★★★ 1 & 5: 제보수단별 전체건수 -->
	<select id="reportmeanTypeAll" parameterType="params" resultType="record">
	SELECT 
	 TT.CODE,SUM(TT.CNT) CNT 
	 FROM   
 	 (    	
	SELECT A.CODE, NVL(B.CNT,0) CNT
	FROM (SELECT ID AS CODE FROM CODE_REPORTMEAN_TYPE) A
		LEFT OUTER JOIN
			( SELECT REPORTMEAN_TYPE, ALL_CNT + O_ALL_CNT CNT
				FROM STAT_RTT_TYPE
				WHERE 1=1
				AND REGION_ID = #{REGION_ID}
		<choose>
			<when test="start_date !=null and start_date neq ''">
				AND SUBSTR(STAT_DATE,0,6) = #{start_date}
			</when>
			<otherwise>
				AND SUBSTR(STAT_DATE,0,6) BETWEEN to_char(add_months(sysdate,-1),'yyyymmdd') AND to_char(SYSDATE,'yyyymmdd')
			</otherwise>
		</choose>
				) B
		ON A.CODE=B.REPORTMEAN_TYPE
	)TT
    GROUP BY TT.CODE
    ORDER BY TT.CODE 	
	</select>
	<!--★★★★★★ 1 & 5: 제보수단별 자국/타국 전체건수-->
	<select id="reportmeanTypeOurOther" parameterType="params" resultType="record">
	 SELECT 
	 TT.CODE, TT.REGION_ID,SUM(TT.CNT) CNT 
	 FROM   
 	 (    
	SELECT T_CODE.CODE, NVL(T_CNT.REGION_ID,#{REGION_ID}) REGION_ID, NVL(T_CNT.CNT,0) CNT
	FROM (SELECT ID AS CODE FROM CODE_REPORTMEAN_TYPE) T_CODE
		LEFT OUTER JOIN
			(SELECT A.REGION_ID,  A.REPORTMEAN_TYPE, A.ALL_CNT CNT
			FROM STAT_RTT_TYPE A
			WHERE 1=1
	<choose>
		<when test="start_date !=null and start_date neq ''">
			AND SUBSTR(STAT_DATE,0,6) = #{start_date}
		</when>
		<otherwise>
			AND SUBSTR(STAT_DATE,0,6) BETWEEN to_char(add_months(sysdate,-1),'yyyymmdd') AND to_char(SYSDATE,'yyyymmdd')
		</otherwise>
	</choose>
			AND A.REGION_ID = #{REGION_ID}
			) T_CNT
		ON T_CODE.CODE=T_CNT.REPORTMEAN_TYPE
	
	UNION ALL
	
	SELECT T_OCODE.CODE, NVL(T_OCNT.REGION_ID,'000') REGION_ID, NVL(T_OCNT.CNT,0) CNT
	FROM (SELECT ID AS CODE FROM CODE_REPORTMEAN_TYPE) T_OCODE
		LEFT OUTER JOIN
			(SELECT '000' REGION_ID, A.REPORTMEAN_TYPE, A.O_ALL_CNT CNT
			FROM STAT_RTT_TYPE A
			WHERE 1=1
	<choose>
		<when test="start_date !=null and start_date neq ''">
			AND SUBSTR(STAT_DATE,0,6) = #{start_date}
		</when>
		<otherwise>
			AND SUBSTR(STAT_DATE,0,6) BETWEEN to_char(add_months(sysdate,-1),'yyyymmdd') AND to_char(SYSDATE,'yyyymmdd')
		</otherwise>
	</choose>
			AND A.REGION_ID = #{REGION_ID}
			) T_OCNT
		ON T_OCODE.CODE=T_OCNT.REPORTMEAN_TYPE
		)TT
    GROUP BY TT.CODE,TT.REGION_ID
    ORDER BY TT.CODE, TT.REGION_ID DESC
	</select>
	
	<!--★★★★★★ 1 & 5: 제보유형별 전체건수 -->
	<select id="reportTypeAll" parameterType="params" resultType="record">
	 SELECT 
	 TT.CODE,SUM(TT.CNT) CNT 
	 FROM   
 	 (   
	SELECT A.CODE, NVL(B.CNT,0) CNT
	FROM (SELECT BAS_SCOD AS CODE FROM CODE_REPORT_TYPE WHERE BAS_LCOD='100') A
		LEFT OUTER JOIN
			( SELECT REPORT_TYPE, ALL_CNT + O_ALL_CNT CNT
				FROM STAT_RPT_TYPE
				WHERE 1=1
				AND REGION_ID = #{REGION_ID}
	<choose>
		<when test="start_date !=null and start_date neq ''">
			AND SUBSTR(STAT_DATE,0,6) = #{start_date}
		</when>
		<otherwise>
			AND SUBSTR(STAT_DATE,0,6) BETWEEN to_char(add_months(sysdate,-1),'yyyymmdd') AND to_char(SYSDATE,'yyyymmdd')
		</otherwise>
	</choose>
				) B
		ON A.CODE=B.REPORT_TYPE
	)TT
    GROUP BY TT.CODE
    ORDER BY TT.CODE 
	</select>
	<!--★★★★★★ 1 & 5: 제보유형별 자국/타국 전체건수-->
	<select id="reportTypeOurOther" parameterType="params" resultType="record">
	 SELECT 
	 TT.CODE, TT.REGION_ID,SUM(TT.CNT) CNT 
	 FROM   
 	 ( 
	SELECT T_CODE.CODE, NVL(T_CNT.REGION_ID,#{REGION_ID}) REGION_ID, NVL(T_CNT.CNT,0) CNT
	FROM (SELECT BAS_SCOD AS CODE FROM CODE_REPORT_TYPE WHERE BAS_LCOD='100') T_CODE
		LEFT OUTER JOIN
			(SELECT A.REGION_ID,  A.REPORT_TYPE, A.ALL_CNT CNT
			FROM STAT_RPT_TYPE A
			WHERE 1=1
	<choose>
		<when test="start_date !=null and start_date neq ''">
			AND SUBSTR(STAT_DATE,0,6) = #{start_date}
		</when>
		<otherwise>
			AND SUBSTR(STAT_DATE,0,6) BETWEEN to_char(add_months(sysdate,-1),'yyyymmdd') AND to_char(SYSDATE,'yyyymmdd')
		</otherwise>
	</choose>
			AND A.REGION_ID = #{REGION_ID}
			) T_CNT
		ON T_CODE.CODE=T_CNT.REPORT_TYPE
	
	UNION ALL
	
	SELECT T_OCODE.CODE, NVL(T_OCNT.REGION_ID,'000') REGION_ID, NVL(T_OCNT.CNT,0) CNT
	FROM (SELECT BAS_SCOD AS CODE FROM CODE_REPORT_TYPE WHERE BAS_LCOD='100') T_OCODE
		LEFT OUTER JOIN
			(SELECT '000' REGION_ID, A.REPORT_TYPE, A.O_ALL_CNT CNT
			FROM STAT_RPT_TYPE A
			WHERE 1=1
			<choose>
				<when test="start_date !=null and start_date neq ''">
					AND SUBSTR(STAT_DATE,0,6) = #{start_date}
				</when>
				<otherwise>
					AND SUBSTR(STAT_DATE,0,6) BETWEEN to_char(add_months(sysdate,-1),'yyyymmdd') AND to_char(SYSDATE,'yyyymmdd')
				</otherwise>
			</choose>
			AND A.REGION_ID = #{REGION_ID}
			) T_OCNT
		ON T_OCODE.CODE=T_OCNT.REPORT_TYPE
	)TT
    GROUP BY TT.CODE,TT.REGION_ID
    ORDER BY TT.CODE, TT.REGION_ID DESC
	</select>
	
	<!-- ###### 표준화통계:교통정보 제공대장 ##### -->
	<!-- 1.제보자별 현황 -->
	<select id="informerTypeData" parameterType="params" resultType="record">
	WITH INFRM AS( SELECT * FROM stat_infrm_type WHERE 1=1 and REGION_ID = #{REGION_ID} and SUBSTR(STAT_DATE,0,6) = #{start_date} <!-- AND #{end_date} -->)
	<!--1.1 자체처리 자국/타국-->
    select tt.* from(
	select '자체처리' as type, region_id,code,SUM(CNT) CNT
	from( 
	select b.region_id,a.type_id as code,nvl(b.send_n,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type 
	union all
	select '000',a.type_id as code,nvl(b.o_send_n,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--1.2 방송요청 자국/타국-->
	union all
    select tt.* from(
	select '방송요청' as type, region_id,code,SUM(CNT) CNT
	from( 
	select b.region_id,a.type_id as code,nvl(b.send_y,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type
	union all
	select '000',a.type_id as code,nvl(b.o_send_y,0) as cnt from code_informer_type a left join INFRM b 
	on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--1.3 방송:합계 자국/타국-->
	union all
    select tt.* from(
	select '방송' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.type_id as code,nvl(b.broad_y,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type
	union all
	select '000',a.type_id as code,nvl(b.o_broad_y,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--1.4 방송:스튜디오(pd) 자국/타국-->
	union all
    select tt.* from(
	select '방송_STUDIO' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.type_id as code,nvl(b.broad_p,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type
	union all
	select '000',a.type_id as code,nvl(b.o_broad_p,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--1.5 방송:캐스터 자국/타국-->
	union all
    select tt.* from(
	select '방송_CASTER' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.type_id as code,nvl(b.broad_c,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type
	union all
	select '000',a.type_id as code,nvl(b.o_broad_c,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--1.6 비방송 자국/타국-->
	union all
    select tt.* from(
	select '비방송' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.type_id as code,nvl(b.broad_n,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type
	union all
	select '000',a.type_id as code,nvl(b.o_broad_n,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--1.7 중요:전송 자국/타국-->
	union all
    select tt.* from(
	select '전송건수' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.type_id as code,nvl(b.imp_y,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type
	union all
	select '000',a.type_id as code,nvl(b.o_imp_y,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--1.8 중요:방송 자국/타국-->
	union all
    select tt.* from(
	select '방송건수' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.type_id as code,nvl(b.impbro_y,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type
	union all
	select '000',a.type_id as code,nvl(b.o_impbro_y,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--1.9 중요:방송:스튜디오(pd) 자국/타국-->
	union all
    select tt.* from(
	select '중요제보_STUDIO' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.type_id as code,nvl(b.impbro_p,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type
	union all
	select '000',a.type_id as code,nvl(b.o_impbro_p,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--1.10 중요:방송:캐스터 자국/타국-->
	union all
    select tt.* from(
	select '중요제보_CASTER' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.type_id as code,nvl(b.impbro_c,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type
	union all
	select '000',a.type_id as code,nvl(b.o_impbro_c,0) as cnt from code_informer_type a 
	left join INFRM b on a.type_id=b.informer_type )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
    
	</select>
	
	<!-- 나.제보수단별 현황 -->
	<select id="reportmeanTypeData" parameterType="params" resultType="record">
	WITH RTT AS( SELECT * FROM stat_rtt_type WHERE 1=1 and REGION_ID = #{REGION_ID} and SUBSTR(STAT_DATE,0,6) = #{start_date})
	<!--2.1 자체처리 자국/타국-->
    select tt.* from(
	select '자체처리' as type, region_id,code,SUM(CNT) CNT
	from( 
	select b.region_id,a.id as code,nvl(b.send_n,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE 
	union all
	select '000',a.id as code,nvl(b.o_send_n,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--2.2 방송요청 자국/타국-->
	union all
    select tt.* from(
	select '방송요청' as type, region_id,code,SUM(CNT) CNT
	from( 
	select b.region_id,a.id as code,nvl(b.send_y,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE
	union all
	select '000',a.id as code,nvl(b.o_send_y,0) as cnt from code_REPORTMEAN_TYPE a left join RTT b 
	on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--2.3 방송:합계 자국/타국-->
	union all
    select tt.* from(
	select '방송' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.id as code,nvl(b.broad_y,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE
	union all
	select '000',a.id as code,nvl(b.o_broad_y,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--2.4 방송:스튜디오(pd) 자국/타국-->
	union all
    select tt.* from(
	select '방송_STUDIO' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.id as code,nvl(b.broad_p,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE
	union all
	select '000',a.id as code,nvl(b.o_broad_p,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--2.5 방송:캐스터 자국/타국-->
	union all
    select tt.* from(
	select '방송_CASTER' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.id as code,nvl(b.broad_c,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE
	union all
	select '000',a.id as code,nvl(b.o_broad_c,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--2.6 비방송 자국/타국-->
	union all
    select tt.* from(
	select '비방송' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.id as code,nvl(b.broad_n,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE
	union all
	select '000',a.id as code,nvl(b.o_broad_n,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--2.7 중요:전송 자국/타국-->
	union all
    select tt.* from(
	select '전송건수' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.id as code,nvl(b.imp_y,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE
	union all
	select '000',a.id as code,nvl(b.o_imp_y,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--2.8 중요:방송 자국/타국-->
	union all
    select tt.* from(
	select '방송건수' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.id as code,nvl(b.impbro_y,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE
	union all
	select '000',a.id as code,nvl(b.o_impbro_y,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--2.9 중요:방송:스튜디오(pd) 자국/타국-->
	union all
    select tt.* from(
	select '중요제보_STUDIO' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.id as code,nvl(b.impbro_p,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE
	union all
	select '000',a.id as code,nvl(b.o_impbro_p,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--2.10 중요:방송:캐스터 자국/타국-->
	union all
    select tt.* from(
	select '중요제보_CASTER' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.id as code,nvl(b.impbro_c,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE
	union all
	select '000',a.id as code,nvl(b.o_impbro_c,0) as cnt from code_REPORTMEAN_TYPE a 
	left join RTT b on a.id=b.REPORTMEAN_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
    
	</select>
	
	<!-- 다.제보유형별 현황 -->
	<select id="reportTypeData" parameterType="params" resultType="record">
	WITH RPT AS( SELECT * FROM stat_rpt_type WHERE 1=1 and REGION_ID = #{REGION_ID} and SUBSTR(STAT_DATE,0,6) = #{start_date})
	,CRT AS (select * from code_REPORT_TYPE where bas_lcod='100')
	
	<!--3.1 자체처리 자국/타국-->
    select tt.* from(
	select '자체처리' as type, region_id,code,SUM(CNT) CNT
	from( 
	select b.region_id,a.bas_scod as code,nvl(b.send_n,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE 
	union all
	select '000',a.bas_scod as code,nvl(b.o_send_n,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--3.2 방송요청 자국/타국-->
	union all
    select tt.* from(
	select '방송요청' as type, region_id,code,SUM(CNT) CNT
	from( 
	select b.region_id,a.bas_scod as code,nvl(b.send_y,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE
	union all
	select '000',a.bas_scod as code,nvl(b.o_send_y,0) as cnt from CRT a left join RPT b 
	on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--3.3 방송:합계 자국/타국-->
	union all
    select tt.* from(
	select '방송' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.bas_scod as code,nvl(b.broad_y,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE
	union all
	select '000',a.bas_scod as code,nvl(b.o_broad_y,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--3.4 방송:스튜디오(pd) 자국/타국-->
	union all
    select tt.* from(
	select '방송_STUDIO' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.bas_scod as code,nvl(b.broad_p,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE
	union all
	select '000',a.bas_scod as code,nvl(b.o_broad_p,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--3.5 방송:캐스터 자국/타국-->
	union all
    select tt.* from(
	select '방송_CASTER' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.bas_scod as code,nvl(b.broad_c,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE
	union all
	select '000',a.bas_scod as code,nvl(b.o_broad_c,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--3.6 비방송 자국/타국-->
	union all
    select tt.* from(
	select '비방송' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.bas_scod as code,nvl(b.broad_n,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE
	union all
	select '000',a.bas_scod as code,nvl(b.o_broad_n,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--3.7 중요:전송 자국/타국-->
	union all
    select tt.* from(
	select '전송건수' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.bas_scod as code,nvl(b.imp_y,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE
	union all
	select '000',a.bas_scod as code,nvl(b.o_imp_y,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--3.8 중요:방송 자국/타국-->
	union all
    select tt.* from(
	select '방송건수' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.bas_scod as code,nvl(b.impbro_y,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE
	union all
	select '000',a.bas_scod as code,nvl(b.o_impbro_y,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--3.9 중요:방송:스튜디오(pd) 자국/타국-->
	union all
    select tt.* from(
	select '중요제보_STUDIO' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.bas_scod as code,nvl(b.impbro_p,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE
	union all
	select '000',a.bas_scod as code,nvl(b.o_impbro_p,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	<!--3.10 중요:방송:캐스터 자국/타국-->
	union all
    select tt.* from(
	select '중요제보_CASTER' as type, region_id,code,SUM(CNT) CNT
	from(
	select b.region_id,a.bas_scod as code,nvl(b.impbro_c,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE
	union all
	select '000',a.bas_scod as code,nvl(b.o_impbro_c,0) as cnt from CRT a 
	left join RPT b on a.bas_scod=b.REPORT_TYPE )t GROUP BY CODE,REGION_ID ORDER BY CODE, REGION_ID DESC)tt
	</select>

	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
		
	<!-- 2. 긴급교통정보_방송현황분석  -->
	<select id="extrBro" parameterType="params" resultType="record">
		with acci as(
		select to_char(RECEIPT_DAY,'yyyymmdd') AS key_date
		,broad_time br_time
		,receipt_day||trim(receipt_time)||'00' rpt_time
		,ROUND(( TO_DATE(broad_time, 'YYYYMMDDHH24MISS') - TO_DATE(to_char(receipt_day,'yyyymmdd')||trim(receipt_time)||'00', 'YYYYMMDDHH24MISS') ) * 24 * 60, 2) AS mm    
		from report_receipt
		where 1=1 
		and receipt_day <![CDATA[>=]]> TRUNC(to_date(concat(#{start_date},'01'),'yyyymmdd'), 'MM') 
        and receipt_day <![CDATA[<=]]> last_day(to_date(concat(#{start_date},'01'),'yyyymmdd'))
		and region_id=#{REGION_ID}
		and FLAG_IMPORTANT='Y'
		)
		
		select a.key_date,a.cnt1,nvl(b.cnt2,0) cnt2 from
		(select key_date,count(key_date)as cnt1 from acci group by key_date)a
		left join
		(select key_date,count(key_date)as cnt2 from acci 
		where br_time is not null and mm <![CDATA[ <= ]]> 5
		group by key_date)b
		on(a.key_date=b.key_date)
		order by a.key_date
	</select>
	
	<!-- 2.1  재난제보 건수  -->
	<select id="disastorStat" parameterType="params" resultType="record">
		with acci as(
				select to_char(RECEIPT_DAY,'yyyymmdd') AS key_date
		        ,FLAG_DISASTOR
				from report_receipt
				where 1=1 
				and receipt_day <![CDATA[>=]]> TRUNC(to_date(concat(#{start_date},'01'),'yyyymmdd'), 'MM') 
		        and receipt_day <![CDATA[<=]]> last_day(to_date(concat(#{start_date},'01'),'yyyymmdd'))
				and region_id=#{REGION_ID}
		)
		select a.key_date,a.cnt1,nvl(b.cnt2,0) cnt2 from	
		     (select key_date,count(key_date)as cnt1
		     from acci group by key_date)a
		        left join
		     (select key_date,count(key_date)as cnt2
		     from acci 
		     WHERE FLAG_DISASTOR='Y'
		    group by key_date
		     )b
		on(a.key_date=b.key_date)
		order by a.key_date
	</select>
	
	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
	
	<!-- 3.1 월별건수 통신원 리스트  -->
	<select id="muJeboList" parameterType="params" resultType="record">
	    <!--통신원 정보(방송국별,통신원타입 : 통신원)-->
	    with infrm as(
		select a.*,b.org_name from
		(select act_id,informer_id,informer_name,org_id,PHONE_CELL,reg_date from informer 
		where area_code =#{REGION_ID} and informer_type='0' and flag_act='Y') a
		left join
		(select org_id,org_name from organization where ind_type='0' and area_code=#{REGION_ID})b
		on(a.org_id=b.org_id)
		),
		<!-- 방송국별 월별 제보건수 -->
		mon as(select ind_id,substr(nvl(stat_mon,'000000'),5,6) as key_date,
		mon_cnt from stat_tbn_monrpt where area_code=#{REGION_ID})
		
        select a.* from infrm a
		order by a.act_id asc
	</select>
	
	<!-- 3.2 월별건수 통신원 현황(수)  -->
	<select id="muJeboCnt" parameterType="params" resultType="record">
	    <!--통신원 정보(방송국별,통신원타입 : 통신원)-->
	    with infrm as(
		select a.*,b.org_name from
		(select act_id,informer_id,informer_name,org_id,reg_date from informer 
		where area_code =#{REGION_ID} and informer_type='0' and flag_act='Y') a
		left join
		(select org_id,org_name from organization where ind_type='0' and area_code=#{REGION_ID})b
		on(a.org_id=b.org_id)
		),
		<!-- 방송국별 월별 제보건수 -->
		mon as(select ind_id,substr(nvl(stat_mon,'000000'),5,6) as key_date,
		stat_mon,mon_cnt from stat_tbn_monrpt where area_code=#{REGION_ID})
		
        select a.*,b.* from infrm a
		left join
		(
			select key_date,ind_id,mon_cnt as cnt from mon 
			where stat_mon between SUBSTR(#{start_date},1,4)||'01' and #{start_date}
		)b
		on(a.informer_id = b.ind_id)
	    order by a.act_id asc, b.key_date asc
	</select>
	
	
	<!-- 03. 무제보 통신원 현황  -->
	<select id="muJeboList2" parameterType="params" resultType="record">
		<!--통신원 정보(방송국별,통신원타입 : 통신원)-->
	    SELECT T.* FROM
        (
            select a.*,b.org_name from
            (
                select act_id,informer_id,informer_name,org_id,PHONE_CELL,reg_date from informer 
                where area_code =#{REGION_ID} and informer_type='0'and flag_act='Y'
            ) a
            left join
            (select org_id,org_name from organization where ind_type='0' and area_code=#{REGION_ID})b
            on(a.org_id=b.org_id)
		)T
        WHERE T.INFORMER_ID IN
		<!-- 방송국별 월별 제보건수 -->
        (
            SELECT A.IND_ID FROM
            (        
                select IND_ID,SUM(MON_CNT) AS CNT from stat_tbn_monrpt 
                where area_code=#{REGION_ID}
				<![CDATA[ 
					and stat_mon >= substr(#{start_date},0,4)||'01'
					and stat_mon < to_char(add_months(to_date(#{start_date},'yyyymm'),1),'yyyymm')
				]]>
                GROUP BY IND_ID
            )A
            WHERE CNT =0
        )
		
	</select>
	
	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
		
	<!-- ####### 4. 제보건수 및 가공건수 ####### -->
	
	<!--★★★★★★ 4.1: 월별 전체 수집건수 -->
	<select id="monthReceipt" parameterType="params" resultType="record">
	select a.stat_month, nvl(sum(cnt),0) as cnt from 
    (
    SELECT nvl(SUBSTR(STAT_DATE,0,6),SUBSTR(#{start_date},1,6)) as STAT_MONTH, NVL((SUM(ALL_CNT)+SUM(O_ALL_CNT)),0) as CNT
	FROM stat_infrm_type
	WHERE REGION_ID = #{REGION_ID}
	<if test="informer_type !=null">
		AND INFORMER_TYPE = #{informer_type}
	</if>
	AND SUBSTR(STAT_DATE,0,6) = SUBSTR(#{start_date},1,6) 
	GROUP BY STAT_DATE
	 )a
    group by a.stat_month
	ORDER BY a.stat_month
	</select>
	
		
	<!--★★★★★★ 4.2: 월별 자국 수집건수 -->
	<select id="monthOurReceipt" parameterType="params" resultType="record">
	   select a.stat_month, nvl(sum(cnt),0) as cnt from 
	   (
		    SELECT nvl(SUBSTR(STAT_DATE,0,6),SUBSTR(#{start_date},1,6)) as STAT_MONTH, nvl(SUM(all_CNT),0) as CNT
			FROM stat_infrm_type
			WHERE REGION_ID = #{REGION_ID}
			<if test="informer_type !=null">
				AND INFORMER_TYPE = #{informer_type}
			</if>
			AND SUBSTR(STAT_DATE,0,6) = SUBSTR(#{start_date},1,6) 
			GROUP BY STAT_DATE
	    )a
    	group by a.stat_month
	</select>
	
	<!--★★★★★★ 4.3: 월별 타국 수집건수 -->
	<select id="monthOtherReceipt" parameterType="params" resultType="record">
	   select a.stat_month, nvl(sum(cnt),0) as cnt from 
	   (
		    SELECT nvl(SUBSTR(STAT_DATE,0,6),SUBSTR(#{start_date},1,6)) as STAT_MONTH, nvl(SUM(o_all_CNT),0) as CNT
			FROM stat_infrm_type
			WHERE REGION_ID = #{REGION_ID}
			<if test="informer_type !=null">
				AND INFORMER_TYPE = #{informer_type}
			</if>
		AND SUBSTR(STAT_DATE,0,6) = SUBSTR(#{start_date},1,6) 
		GROUP BY STAT_DATE
		)a
    	group by a.stat_month
	</select>
	
	<!--★★★★★★ 4.4: 월별 제보자 수 -->
	<select id="monthInformer" parameterType="params" resultType="record">
	SELECT #{start_date} as STAT_MONTH, COUNT(*) as CNT FROM INFORMER 
	WHERE AREA_CODE=#{REGION_ID} 
	AND INFORMER_TYPE=#{informer_type}
	AND FLAG_ACT='Y'
	</select>
	
	<!--★★★★★★ 4.5: 월별 1건이상 제보자 수 -->
	<select id="monthInformer1Inform" parameterType="params" resultType="record">
	SELECT #{start_date} as STAT_MONTH, COUNT(*) as CNT FROM STAT_TBN_MONRPT 
    WHERE 1=1
    AND MON_CNT <![CDATA[ >= ]]> 1
    AND area_code=#{REGION_ID} 
    AND IND_TYPE=#{informer_type}
	AND SUBSTR(STAT_MON,0,6) = SUBSTR(#{start_date},1,6)
	</select>
	
	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
	
	<!-- ####### 5. 교통정보 수집건수 및 활용실적 ####### -->
	
	<!--★★★★★★ 5.1: 제보자별 일별 상세 -->
	<select id="receiptUseDaily" parameterType="params" resultType="record">
	SELECT A.REGION_ID, A.STAT_DATE, A.INFORMER_TYPE, SUM(ALL_CNT) CNT
	FROM STAT_INFRM_TYPE A
	WHERE SUBSTR(A.STAT_DATE,0,6) = #{start_date}
	AND A.REGION_ID = #{REGION_ID}
	group by A.REGION_ID, A.STAT_DATE, A.INFORMER_TYPE
	UNION ALL
	SELECT '000' REGION_ID, A.STAT_DATE, A.INFORMER_TYPE, SUM(O_ALL_CNT) CNT
	FROM STAT_INFRM_TYPE A
	WHERE SUBSTR(A.STAT_DATE,0,6) = #{start_date}
	AND A.REGION_ID = #{REGION_ID}
	GROUP BY A.STAT_DATE, A.INFORMER_TYPE
	ORDER BY STAT_DATE, INFORMER_TYPE, REGION_ID DESC
	</select>
	
	<!--★★★★★★ 5.2 월별 방송자료(전송)/자체처리(비전송)/안내/기관통보 -->
	<!-- 교통정보 제공대장과 비교해보니 자 타국 모두 합치는듯 -->
	<select id="monthSendYNA07A08" parameterType="params" resultType="record">
	    <!-- B : 방송자료 -->
	    SELECT SUBSTR(#{start_date},0,6) STAT_DATE ,a.code, 'B' SEQ, nvl(b.cnt ,0) CNT
	    FROM 
	    (SELECT TYPE_ID AS CODE FROM CODE_INFORMER_TYPE) a
	    left join
	    (SELECT informer_type, SUM(SEND_Y)+SUM(O_SEND_Y) CNT 
	    FROM STAT_INFRM_TYPE
		WHERE SUBSTR(STAT_DATE,0,6) = #{start_date}
	    and REGION_ID = #{REGION_ID}
		GROUP BY SUBSTR(STAT_DATE,0,6),informer_type)b
	    on(a.code=b.informer_type)
		
		UNION ALL
		<!-- NB : 자체처리 -->
		SELECT SUBSTR(#{start_date},0,6) STAT_DATE ,a.code, 'NB' SEQ, nvl(b.cnt ,0) CNT
	    FROM 
	    (SELECT TYPE_ID AS CODE FROM CODE_INFORMER_TYPE) a
	    left join
	    (SELECT informer_type,SUM(SEND_N)+SUM(O_SEND_N) CNT 
	    FROM STAT_INFRM_TYPE
		WHERE SUBSTR(STAT_DATE,0,6) = #{start_date}
	    and REGION_ID = #{REGION_ID}
		GROUP BY SUBSTR(STAT_DATE,0,6),informer_type)b
	    on(a.code=b.informer_type)
		
		UNION ALL
		<!-- A07 : 안내 -->
		SELECT SUBSTR(#{start_date},0,6) STAT_DATE ,a.code, 'A07' SEQ, nvl(b.cnt ,0) CNT
	    FROM 
	    (SELECT TYPE_ID AS CODE FROM CODE_INFORMER_TYPE) a
	    left join
	    (SELECT informer_type,SUM(GID_CNT) CNT 
	    FROM STAT_INFRM_TYPE
		WHERE SUBSTR(STAT_DATE,0,6) = #{start_date}
	    and REGION_ID = #{REGION_ID}
		GROUP BY SUBSTR(STAT_DATE,0,6),informer_type)b
	    on(a.code=b.informer_type)
		
		UNION ALL
		<!-- A08 : 기관통보 -->
		SELECT SUBSTR(#{start_date},0,6) STAT_DATE ,a.code, 'A08' SEQ, nvl(b.cnt ,0) CNT
	    FROM 
	    (SELECT TYPE_ID AS CODE FROM CODE_INFORMER_TYPE) a
	    left join
	    (SELECT informer_type,SUM(ORG_NT_CNT) CNT 
	    FROM STAT_INFRM_TYPE
		WHERE SUBSTR(STAT_DATE,0,6) = #{start_date}
	    and REGION_ID = #{REGION_ID}
		GROUP BY SUBSTR(STAT_DATE,0,6),informer_type)b
	    on(a.code=b.informer_type)
		ORDER BY code,SEQ
	</select>
	
	<!--★★★★★★ 5.2 일별 방송국별 방송자료(전송)/자체처리(비전송)/안내/기관통보 -->
	<select id="dailyRegionSendYNA07A08" parameterType="params" resultType="record">
		SELECT stat_date, informer_type, 'B' SEQ, SUM(SEND_Y) CNT
		FROM STAT_INFRM_TYPE
		WHERE SUBSTR(STAT_DATE,0,6) = #{start_date}
	    and REGION_ID = #{REGION_ID}
		GROUP BY stat_date,informer_type
		
		UNION ALL
		
		SELECT stat_date, informer_type, 'NB' SEQ, SUM(SEND_N) CNT
		FROM STAT_INFRM_TYPE
		WHERE SUBSTR(STAT_DATE,0,6) = #{start_date}
	    and REGION_ID = #{REGION_ID}
		GROUP BY stat_date,informer_type 
		
		UNION ALL
		
		SELECT stat_date, informer_type, 'A07' SEQ, SUM(GID_CNT) CNT
		FROM STAT_INFRM_TYPE
		WHERE SUBSTR(STAT_DATE,0,6) = #{start_date}
	    and REGION_ID = #{REGION_ID}
		GROUP BY stat_date,informer_type 
		
		UNION ALL
		
		SELECT stat_date, informer_type, 'A08' SEQ, SUM(ORG_NT_CNT) CNT
		FROM STAT_INFRM_TYPE
		WHERE SUBSTR(STAT_DATE,0,6) = #{start_date}
	    and REGION_ID = #{REGION_ID}
		GROUP BY stat_date,informer_type
		ORDER BY STAT_DATE, INFORMER_TYPE
	</select>
	
	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
	
	<!-- 6. 돌발정보 표출실적 -->
	<select id="nationalIncident" parameterType="params" resultType="record">
	    with monicd as
		(
		select receipt_id,report_type,report_type2,receipt_day,region_id
		from report_receipt 
		where region_id=#{REGION_ID} 
		and receipt_day <![CDATA[>=]]> concat(substr(#{start_date},0,4),'0101')
		and report_type in('A02','A03','A04','A06'))
		<!-- 공사,행사,사고,고장,기타 -->
		select * from
		(
			<foreach collection="monList" item="item" index="i" separator="union">
			    select STAT_MONTH,CNT1,CNT2,CNT3,CNT4,CNT5,(CNT1+CNT2+CNT3+CNT4+CNT5) as SUMC FROM
				(
					select substr(to_char(add_months(to_date(#{start_date},'yyyymm'),-#{item}),'yyyymm'),5,6) as STAT_MONTH  
					
					,nvl((
						select count(receipt_id) from monicd 
						where region_id=#{REGION_ID} 
						and receipt_day <![CDATA[>=]]> TRUNC(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'), 'MM') 
						and receipt_day <![CDATA[<=]]> last_day(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'))
						and report_type='A02'
						group by report_type)
					,0) as CNT1
					,nvl((
						select count(receipt_id) from monicd 
						where region_id=#{REGION_ID} 
						and receipt_day <![CDATA[>=]]> TRUNC(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'), 'MM') 
						and receipt_day <![CDATA[<=]]> last_day(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'))
						and report_type='A03'
						group by report_type)
					,0) as CNT2
					,nvl((
						select count(receipt_id) from monicd 
						where region_id=#{REGION_ID} 
						and receipt_day <![CDATA[>=]]> TRUNC(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'), 'MM') 
						and receipt_day <![CDATA[<=]]> last_day(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'))
						and report_type='A04'
						group by report_type)
					,0) as CNT3
					,nvl((
						select count(receipt_id) from monicd 
						where region_id=#{REGION_ID} 
						and receipt_day <![CDATA[>=]]> TRUNC(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'), 'MM') 
						and receipt_day <![CDATA[<=]]> last_day(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'))
						and report_type='A06'
						and report_type2 ='B00' group by report_type)
					,0) as CNT4
					,nvl((
						select count(receipt_id) from monicd 
						where region_id=#{REGION_ID} 
						and receipt_day <![CDATA[>=]]> TRUNC(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'), 'MM') 
						and receipt_day <![CDATA[<=]]> last_day(to_date(concat(#{start_date}-#{item},'01'),'yyyymmdd'))
						and report_type='A06'
						and report_type2 !='B00' group by report_type)
					,0) as CNT5
					from dual
				)
			</foreach>
		)
	</select>
	
	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
	
	<!-- 7. 교통정보 수집원 현황 -->
	<select id="informerStats" parameterType="params" resultType="record">
	  
	  <!-- 선택 방송국 통신원 개인별 통신원종류,기관종류,및 정보 -->
	  with indt as(
        select 
        b.type_id as ind_type
        ,b.type_name as ind_name
        ,nvl(c.org_id,'999999') as org_id 
        ,nvl(c.org_name ,'무소속') as org_name
        ,a.informer_id
        ,a.flag_act
        from 
        (select * from  informer where area_code=#{REGION_ID} )a
        right join
        code_informer_type b
        on(a.informer_type=b.type_id)
        left join
        (select * from organization where area_code=#{REGION_ID}) c
        on(a.informer_type=c.ind_type and a.org_id =c.org_id)
        where b.type_id !='2'
	  ),
	  <!-- 이번달 통신원 히스토리 변경자(위,해촉 전체) -->
	  tmifm as(select informer_id,informer_type,nvl(org_id,'999999') as org_id,flag_act from informer where area_code=#{REGION_ID} and informer_id in
	  (select informer_id from informer_history where region_id=#{REGION_ID} and substr(replace(update_date,'-'),0,6)=#{start_date}))
      
      select t1.*
	  ,nvl(t2.cnt1,0) as cnt1
      ,nvl(t2.cnt2,0) as cnt2
      ,nvl(t2.cnt3,0) as cnt3
      ,nvl(t2.cnt4,0) as cnt4
      ,nvl(t2.cnt5,0) as cnt5
      from
      (select a.ind_type, a.org_id, a.org_name, a.ind_name from indt a group by a.ind_type, a.org_id, a.org_name, a.ind_name)t1
      
     left join
      
	 <!-- cnt1 : 전월 수(전체 수-증감수), cnt2 : 금월 수(전체 수), cnt3 : 증감 수(위촉-해촉), cnt4 : 위촉 수,cnt5 : 해촉 수 -->
	(
	select c.ind_type,c.ind_name,c.org_id,c.org_name
	  , c.cnt-d.cnt+e.cnt as cnt1 <!-- 전월 -->
	  , c.cnt as cnt2 <!-- 금월 -->
	  , d.cnt-e.cnt as cnt3 <!--증감 -->
	  , d.cnt as cnt4 <!-- 금월위촉 --> 
	  , e.cnt as cnt5 <!-- 금월해촉 -->
	  from
      <!-- 이번달 전체(해촉제외: 순수 금월 계) -->
	  (select a.ind_type,a.ind_name,a.org_id,a.org_name,count(a.informer_id) as cnt from 
	       indt a 
           where a.flag_act!='N'
           group by a.ind_type, a.org_id, a.org_name, a.ind_name) c
	   <!-- 이번달 위촉 -->
       left join
	  (
           select a.ind_type,a.ind_name,a.org_id,a.org_name,count(b.informer_id) as cnt from 
	       indt a left join 
	       (select * from tmifm where flag_act='Y') b 
	       on(a.informer_id=b.informer_id)
           group by a.ind_type, a.org_id, a.org_name, a.ind_name
      ) d
      on(c.ind_type=d.ind_type and c.org_id=d.org_id)
	   <!-- 이번달 해촉 -->
       left join
       (
	        select a.ind_type,a.ind_name,a.org_id,a.org_name,count(b.informer_id) as cnt from 
	       indt a left join 
	       (select * from tmifm where flag_act='N') b 
	       on(a.informer_id=b.informer_id)
           group by a.ind_type, a.org_id, a.org_name, a.ind_name
	   )e
       on(c.ind_type=e.ind_type and c.org_id=e.org_id)
      )t2
      on(t1.ind_type=t2.ind_type and t1.org_id=t2.org_id)
	  order by TO_NUMBER(t1.ind_type),TO_NUMBER(t1.org_id),t1.org_name
	  
	  
	</select>
	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
	
	<!-- 8. 한국가스기술공사 제보현황 : 월별 제보수 -->
	<select id="krGasMonCnt" parameterType="params" resultType="record">
		with stat as(
		    SELECT C.* ,NVL(D1+D2+D3+D4+D5+D6+D7+D8+D9+D10+D11+D12,0) AS SUM_CNT 
		    FROM
		    (
		        SELECT ACT_ID,INFORMER_NAME,CAR_NUM,PHONE_CELL 
		        ,NVL(t1,0) AS D1	,NVL(t2,0) AS D2	,NVL(t3,0) AS D3	,NVL(t4,0) AS D4	,NVL(t5,0) AS D5	,NVL(t6,0) AS D6	
		        ,NVL(t7,0) AS D7	,NVL(t8,0) AS D8	,NVL(t9,0) AS D9	,NVL(t10,0) AS D10	,NVL(t11,0) AS D11	,NVL(t12,0) AS D12	
		        
		        FROM
		        (
		            SELECT * FROM
		            (
		                select substr(nvl(b.key_date,'000000'),5,6) as key_date, a.informer_name, a.act_id,a.car_num
		                ,a.informer_id, a.phone_cell
		                ,nvl(b.cnt,0) as cnt 
		                from 
		                (
		                    select * from informer where area_code =#{REGION_ID}  and org_id 
		                    =(select org_id from organization where org_name like '%가스기술%' and area_code=#{REGION_ID} )
		                ) A
		                left join
		                (
		                    select stat_mon as key_date,ind_id ,mon_cnt cnt
		                    from stat_tbn_monrpt
		                    where 1=1
		                    and	SUBSTR(stat_mon,0,4) = SUBSTR(#{start_date},0,4)
		                    and ind_id in 
		                    (
		                        select informer_id from 
		                        (
		                            select * from informer where area_code =#{REGION_ID}  and org_id 
		                            =(select org_id from organization where org_name like '%가스기술%' and area_code=#{REGION_ID} )
		                        )
		                    )
		                )B
		                on(A.informer_id=B.ind_id)
		                where b.cnt !=0
		                order by b.key_date , a.act_id
		            )
		            PIVOT(
		                SUM(cnt)
		                FOR key_date in 
		                (
		                    '01' AS T1 ,'02' AS T2 ,'03' AS T3 ,'04' AS T4 ,'05' AS T5 ,'06' AS T6 ,'07' AS T7 ,'08' AS T8 ,'09' AS T9 ,'10' AS T10 ,'11' AS T11 ,'12' AS T12
		                )
		            )    
		        )
		    )C
		)
		
		select * from
		(
		    select 
		     'sum' as ACT_ID
		    ,'sum' as INFORMER_NAME
		    ,'sum' as CAR_NUM
		    ,'sum' as PHONE_CELL
		    ,sum(d1)   AS D1
		    ,sum(d2)  AS D2
		    ,sum(d3)  AS D3
		    ,sum(d4)  AS D4
		    ,sum(d5)  AS D5
		    ,sum(d6)  AS D6
		    ,sum(d7)  AS D7
		    ,sum(d8)  AS D8
		    ,sum(d9)  AS D9
		    ,sum(d10) AS D10
		    ,sum(d11) AS D11
		    ,sum(d12) AS D12
		    ,sum(d1) +sum(d2) +sum(d3) +sum(d4) +sum(d5) +sum(d6) +sum(d7) +sum(d8) +sum(d9) +sum(d10)+sum(d11)+sum(d12) AS SUM_CNT
		    from stat
		    union
		    SELECT * FROM STAT
		)
	</select>
	
	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
	
	<!-- 9. 한국국토정보공사 제보현황 : 월별 제보수 -->
	<select id="korLxMonCnt" parameterType="params" resultType="record">
		with stat as(
		    SELECT C.* ,NVL(D1+D2+D3+D4+D5+D6+D7+D8+D9+D10+D11+D12,0) AS SUM_CNT 
		    FROM
		    (
		        SELECT ACT_ID,INFORMER_NAME,PHONE_CELL 
		        ,NVL(t1,0) AS D1	,NVL(t2,0) AS D2	,NVL(t3,0) AS D3	,NVL(t4,0) AS D4	,NVL(t5,0) AS D5	,NVL(t6,0) AS D6	
		        ,NVL(t7,0) AS D7	,NVL(t8,0) AS D8	,NVL(t9,0) AS D9	,NVL(t10,0) AS D10	,NVL(t11,0) AS D11	,NVL(t12,0) AS D12	
		        
		        FROM
		        (
		            SELECT * FROM
		            (
		                select substr(nvl(b.key_date,'000000'),5,6) as key_date, a.informer_name, a.act_id
		                ,a.informer_id, a.phone_cell
		                ,nvl(b.cnt,0) as cnt 
		                from 
		                (
		                    select * from informer where area_code =#{REGION_ID} and org_id 
		                    =(select org_id from organization where org_name like '%국토정보%' and area_code=#{REGION_ID})
		                ) A
		                left join
		                (
		                    select stat_mon as key_date,ind_id ,mon_cnt cnt
		                    from stat_tbn_monrpt
		                    where 1=1
		                    and	SUBSTR(stat_mon,0,4) = SUBSTR(#{start_date},0,4)
		                    and ind_id in 
		                    (
		                        select informer_id from 
		                        (
		                            select * from informer where area_code =#{REGION_ID} and org_id 
		                            =(select org_id from organization where org_name like '%국토정보%' and area_code=#{REGION_ID})
		                        )
		                    )
		                )B
		                on(A.informer_id=B.ind_id)
		                where b.cnt !=0
		                order by b.key_date , a.act_id
		            )
		            PIVOT(
		                SUM(cnt)
		                FOR key_date in 
		                (
		                    '01' AS T1 ,'02' AS T2 ,'03' AS T3 ,'04' AS T4 ,'05' AS T5 ,'06' AS T6 ,'07' AS T7 ,'08' AS T8 ,'09' AS T9 ,'10' AS T10 ,'11' AS T11 ,'12' AS T12
		                )
		            )    
		        )
		    )C
		)
		
		select * from
		(
		    select 
		     'sum' as ACT_ID
		    ,'sum' as INFORMER_NAME
		    ,'sum' as PHONE_CELL
		    ,sum(d1)   AS D1
		    ,sum(d2)  AS D2
		    ,sum(d3)  AS D3
		    ,sum(d4)  AS D4
		    ,sum(d5)  AS D5
		    ,sum(d6)  AS D6
		    ,sum(d7)  AS D7
		    ,sum(d8)  AS D8
		    ,sum(d9)  AS D9
		    ,sum(d10) AS D10
		    ,sum(d11) AS D11
		    ,sum(d12) AS D12
		    ,sum(d1) +sum(d2) +sum(d3) +sum(d4) +sum(d5) +sum(d6) +sum(d7) +sum(d8) +sum(d9) +sum(d10)+sum(d11)+sum(d12) AS SUM_CNT
		    from stat
		    union
		    SELECT * FROM STAT
		)
	</select>
	
	
	<!-- 강원 이경희 차장 요청사항	 -->
	<!-- 10 일별 제보건수 -->
		<select id="dayReceipt" parameterType="params" resultType="record">
		SELECT
			 A.ACT_ID
			,A.INFORMER_NAME
	        ,A.PHONE_CELL
	        ,A.ORG_NAME
	        ,A.BIRTHDAY
			,NVL(t1+t2+t3+t4+t5+t6+t7+t8+t9+t10+t11+t12+t13+t14+t15+t16+t17+t18+t19+t20+t21+t22+t23+t24+t25+t26+t27+t28+t29+t30+t31,0) AS SUM_CNT
	        ,NVL(t1,0) AS D1	,NVL(t2,0) AS D2	,NVL(t3,0) AS D3	,NVL(t4,0) AS D4	,NVL(t5,0) AS D5	,NVL(t6,0) AS D6	,NVL(t7,0) AS D7	,NVL(t8,0) AS D8	,NVL(t9,0) AS D9	,NVL(t10,0) AS D10	,NVL(t11,0) AS D11	,NVL(t12,0) AS D12	,NVL(t13,0) AS D13	,NVL(t14,0) AS D14	,NVL(t15,0) AS D15	,NVL(t16,0) AS D16	,NVL(t17,0) AS D17	,NVL(t18,0) AS D18	,NVL(t19,0) AS D19	,NVL(t20,0) AS D20	,NVL(t21,0) AS D21	,NVL(t22,0) AS D22	,NVL(t23,0) AS D23	,NVL(t24,0) AS D24	,NVL(t25,0) AS D25	,NVL(t26,0) AS D26	,NVL(t27,0) AS D27	,NVL(t28,0) AS D28	,NVL(t29,0) AS D29	,NVL(t30,0) AS D30	,NVL(t31,0) AS D31
		from
		(
		    select informer_id,act_id,informer_name,phone_cell,BIRTHDAY,org_id,NVL(org_name,'정보없음')AS ORG_NAME from informer
		    where area_code=#{REGION_ID}
		    and org_id=#{org_id}
            AND FLAG_ACT ='Y'
		)A
		left join
		(
            SELECT * FROM(
                select to_number(substr(receipt_day,7,8)) as receipt_day,individual_id from report_receipt
                        where receipt_day <![CDATA[>=]]> TRUNC(to_date(concat(#{start_date},'01'),'yyyymmdd'), 'MM') 
                        and receipt_day <![CDATA[<=]]> last_day(to_date(concat(#{start_date},'01'),'yyyymmdd'))
                        and region_id=#{REGION_ID}
                        and individual_id is not null
            )
            
            PIVOT(
                COUNT(*)
                FOR receipt_day in 
                (
                 1 as t1 	,2 as t2 	,3 as t3 	,4 as t4 	,5 as t5 	,6 as t6 	,7 as t7 	,8 as t8 	,9 as t9 	,10 as t10 	,11 as t11 	,12 as t12 	,13 as t13 	,14 as t14 	,15 as t15 	,16 as t16 	,17 as t17 	,18 as t18 	,19 as t19 	,20 as t20 	,21 as t21 	,22 as t22 	,23 as t23 	,24 as t24 	,25 as t25 	,26 as t26 	,27 as t27 	,28 as t28 	,29 as t29 	,30 as t30 	,31 as t31 
                )
            )          
		)B
		on(A.informer_id=B.individual_id)
		order by TO_NUMBER(ACT_ID) ASC
	</select>
	
	<!-- 10.0 통신원별 기관-->
	<select id="orgType" parameterType="params" resultType="record">
		SELECT ORG_ID,ORG_NAME FROM ORGANIZATION
		WHERE AREA_CODE=#{REGION_ID}
	</select>
	
	<!-- 10.1 일자별 제보건수 : 통신원-->
	<select id="dayReceiptInfrm" parameterType="params" resultType="record">
		SELECT 
		 INFORMER_ID
		,ACT_ID 
		,INFORMER_NAME 
		,PHONE_CELL
		,BIRTHDAY 
		,ORG_ID
		,ORG_NAME 
		from informer
		WHERE FLAG_ACT='Y' AND AREA_CODE=#{REGION_ID}
		and org_id=#{org_type}
	</select>
	
	<!-- 10.2 일자별 제보건수 : 건수-->
	<select id="dayReceiptCnt" parameterType="params" resultType="record">
		SELECT
		A.INFORMER_ID 
		,TO_NUMBER(SUBSTR(B.RECEIPT_DAY,7,8)) AS N_DATE
        ,SUBSTR(B.RECEIPT_DAY,7,8) AS KEY_DATE  
		,B.TT AS CNT 
		from
		(
		    select informer_id,act_id,informer_name,phone_cell,BIRTHDAY,org_id,NVL(org_name,'정보없음')AS ORG_NAME from informer
		    where area_code=#{REGION_ID} 
		    and org_id=#{org_type}
		)A
		left join
		(
		    select receipt_day,individual_id,count(individual_id) as tt from report_receipt
		    where receipt_day like #{start_date}||'%'
		    group by receipt_day,individual_id
		)B
		on(A.informer_id=B.individual_id)
		where B.individual_id is not null
		
		order by B.RECEIPT_DAY asc,ORG_ID ASC, TO_NUMBER(ACT_ID) ASC
	    
	</select>
		
	<!-- 11. 사회봉사자 실적-->
	<select id="volunteer" parameterType="params" resultType="record">
		SELECT
			A.ACT_ID
			,A.INFORMER_NAME
	        ,A.PHONE_CELL
	        ,A.ORG_NAME
	        ,A.BIRTHDAY
			,NVL(t1+t2+t3+t4+t5+t6+t7+t8+t9+t10+t11+t12+t13+t14+t15+t16+t17+t18+t19+t20+t21+t22+t23+t24+t25+t26+t27+t28+t29+t30+t31,0) AS SUM_CNT
	        ,NVL(t1,0) AS D1	,NVL(t2,0) AS D2	,NVL(t3,0) AS D3	,NVL(t4,0) AS D4	,NVL(t5,0) AS D5	,NVL(t6,0) AS D6	,NVL(t7,0) AS D7	,NVL(t8,0) AS D8	,NVL(t9,0) AS D9	,NVL(t10,0) AS D10	,NVL(t11,0) AS D11	,NVL(t12,0) AS D12	,NVL(t13,0) AS D13	,NVL(t14,0) AS D14	,NVL(t15,0) AS D15	,NVL(t16,0) AS D16	,NVL(t17,0) AS D17	,NVL(t18,0) AS D18	,NVL(t19,0) AS D19	,NVL(t20,0) AS D20	,NVL(t21,0) AS D21	,NVL(t22,0) AS D22	,NVL(t23,0) AS D23	,NVL(t24,0) AS D24	,NVL(t25,0) AS D25	,NVL(t26,0) AS D26	,NVL(t27,0) AS D27	,NVL(t28,0) AS D28	,NVL(t29,0) AS D29	,NVL(t30,0) AS D30	,NVL(t31,0) AS D31
		from
		(
		    select informer_id,act_id,informer_name,phone_cell,BIRTHDAY,org_id,NVL(org_name,'정보없음')AS ORG_NAME from informer
		    where area_code=#{REGION_ID}
		    and flag_service = 'Y'
            AND FLAG_ACT ='Y'
		)A
		left join
		(
            SELECT * FROM(
                select to_number(substr(receipt_day,7,8)) as receipt_day,individual_id from report_receipt
                        where receipt_day <![CDATA[>=]]> TRUNC(to_date(concat(#{start_date},'01'),'yyyymmdd'), 'MM') 
                        and receipt_day <![CDATA[<=]]> last_day(to_date(concat(#{start_date},'01'),'yyyymmdd'))
                        and region_id=#{REGION_ID}
                        and individual_id is not null
            )
            
            PIVOT(
                COUNT(*)
                FOR receipt_day in 
                (
                 1 as t1 	,2 as t2 	,3 as t3 	,4 as t4 	,5 as t5 	,6 as t6 	,7 as t7 	,8 as t8 	,9 as t9 	,10 as t10 	,11 as t11 	,12 as t12 	,13 as t13 	,14 as t14 	,15 as t15 	,16 as t16 	,17 as t17 	,18 as t18 	,19 as t19 	,20 as t20 	,21 as t21 	,22 as t22 	,23 as t23 	,24 as t24 	,25 as t25 	,26 as t26 	,27 as t27 	,28 as t28 	,29 as t29 	,30 as t30 	,31 as t31 
                )
            )          
		)B
		on(A.informer_id=B.individual_id)
		order by TO_NUMBER(ACT_ID) ASC
	</select>
	
	<!-- 제보수단 -->
	<resultMap type="optInftVo" id="statRtt">
		<result property="ifmId1" column="ID"/>
	</resultMap>
	<select id="statRtt"  resultMap="statRtt">
		select id from code_reportmean_type	    
	</select>
	
	<!-- ##################################집계용 스케줄러##################################### -->
	
	<!-- 통신원별 제보통계 테이블 쿼리 -->
	<insert id="statInfrmType" parameterType="java.lang.String" >
		INSERT INTO STAT_INFRM_TYPE
		(
		STAT_DATE
		,REGION_ID
		,INFORMER_TYPE
		
		,ALL_CNT
		,SEND_Y
		,SEND_N
		
		,BROAD_Y
		,BROAD_P
		,BROAD_C
		,BROAD_N
		
		,IMP_Y
		,IMP_N
		
		,IMPBRO_Y
		,IMPBRO_P
		,IMPBRO_C
		
		,O_ALL_CNT
		,O_SEND_Y
		,O_SEND_N
		
		,O_BROAD_Y
		,O_BROAD_P
		,O_BROAD_C
		,O_BROAD_N
		
		,O_IMP_Y
		,O_IMP_N
		,O_IMPBRO_Y
		,O_IMPBRO_P
		,O_IMPBRO_C
		
		,GID_CNT
		,ORG_NT_CNT
		)
		
		with our as
		(
			select a.* from 
			(select receipt_id ,individual_id ,INDIVIDUAL_TYPE,report_type,region_id
			,FLAG_SEND ,FLAG_IMPORTANT ,FLAG_BROD ,BROAD_TIME		
			from report_receipt where receipt_day=to_char(sysdate-1,'yyyymmdd') 
		    and region_id=#{areaCode}
		    AND INDIVIDUAL_TYPE=#{ifmId1}
			)a
			left join
			(select informer_id,area_code from informer)b
			on(a.individual_id=b.informer_id)
			where a.region_id=b.area_code
			<!-- 통신원 id가 null인 통신원은 시민임 -->
			union all
			
			select receipt_id ,individual_id ,INDIVIDUAL_TYPE,report_type,region_id
			,FLAG_SEND ,FLAG_IMPORTANT ,FLAG_BROD ,BROAD_TIME		
			from report_receipt where receipt_day=to_char(sysdate-1,'yyyymmdd') 
		    and region_id=#{areaCode}
		    AND INDIVIDUAL_TYPE=#{ifmId1}
		    
		    and individual_id is null
		),
		oth as
		(
		    select a.* from 
		    (select receipt_id ,individual_id ,INDIVIDUAL_TYPE,report_type,region_id
		    ,FLAG_SEND ,FLAG_IMPORTANT ,FLAG_BROD ,BROAD_TIME		
		    from report_receipt where receipt_day=to_char(sysdate-1,'yyyymmdd') 
		    and region_id=#{areaCode}
		    AND INDIVIDUAL_TYPE=#{ifmId1}
		    )a
		    left join
		    (select informer_id,area_code from informer)b
		    on(a.individual_id=b.informer_id)
		    where a.region_id!=b.area_code
		)
		select 
		to_char(sysdate-1,'yyyymmdd')
		,#{areaCode}
		,#{ifmId1}
		,(select count(receipt_id) from our) 
		,(select count(receipt_id) from our where flag_send='Y') 
		,(select count(receipt_id) from our where flag_send='N') 
		,(select count(receipt_id) from our where flag_brod!='N') 
		,(select count(receipt_id) from our where flag_brod='Y') 
		,(select count(receipt_id) from our where flag_brod='C') 
		,(select count(receipt_id) from our where flag_brod='N' and flag_send='Y')
		,(select count(receipt_id) from our where flag_important='Y') 
		,(select count(receipt_id) from our where flag_important='N')
		,(select count(receipt_id) from our where flag_important='Y' and flag_brod!='N') 
		,(select count(receipt_id) from our where flag_important='Y' and flag_brod='Y') 
		,(select count(receipt_id) from our where flag_important='Y' and flag_brod='C') 
		,(select count(receipt_id) from oth) 
		,(select count(receipt_id) from oth where flag_send='Y') 
		,(select count(receipt_id) from oth where flag_send='N') 
		,(select count(receipt_id) from oth where flag_brod!='N')
		,(select count(receipt_id) from oth where flag_brod='Y') 
		,(select count(receipt_id) from oth where flag_brod='C') 
		,(select count(receipt_id) from oth where flag_brod='N' and flag_send='Y') 
		,(select count(receipt_id) from oth where flag_important='Y')
		,(select count(receipt_id) from oth where flag_important='N') 
		,(select count(receipt_id) from oth where flag_important='Y' and flag_brod!='N') 
		,(select count(receipt_id) from oth where flag_important='Y' and flag_brod='Y') 
		,(select count(receipt_id) from oth where flag_important='Y' and flag_brod='C') 
		,(select count(receipt_id) from our where report_type='A07') + (select count(receipt_id) from oth where report_type='A07')
		,(select count(receipt_id) from our where report_type='A08') + (select count(receipt_id) from oth where report_type='A08')  
		from dual
	</insert>
	
	<!-- 제보유형별 제보통계 테이블 쿼리 -->
	<insert id="statRptType" parameterType="java.lang.String">
		INSERT INTO STAT_RPT_TYPE
		(
		STAT_DATE
		,REGION_ID
		,REPORT_TYPE
		
		,ALL_CNT
		,SEND_Y
		,SEND_N
		
		,BROAD_Y
		,BROAD_P
		,BROAD_C
		,BROAD_N
		
		,IMP_Y
		,IMP_N
		
		,IMPBRO_Y
		,IMPBRO_P
		,IMPBRO_C
		
		,O_ALL_CNT
		,O_SEND_Y
		,O_SEND_N
		
		,O_BROAD_Y
		,O_BROAD_P
		,O_BROAD_C
		,O_BROAD_N
		
		,O_IMP_Y
		,O_IMP_N
		,O_IMPBRO_Y
		,O_IMPBRO_P
		,O_IMPBRO_C
		)
		
		with our as
		(
			select a.* from 
			(select receipt_id ,individual_id ,INDIVIDUAL_TYPE,report_type,region_id
			,FLAG_SEND ,FLAG_IMPORTANT ,FLAG_BROD ,BROAD_TIME		
			from report_receipt where receipt_day=to_char(sysdate-1,'yyyymmdd') 
		    and region_id=#{areaCode}
		    AND REPORT_TYPE=#{basScod}
			)a
			left join
			(select informer_id,area_code from informer)b
			on(a.individual_id=b.informer_id)
			where a.region_id=b.area_code
			
			<!-- 통신원 id가 null인 통신원은 시민임 -->
			union all
			
			select receipt_id ,individual_id ,INDIVIDUAL_TYPE,report_type,region_id
			,FLAG_SEND ,FLAG_IMPORTANT ,FLAG_BROD ,BROAD_TIME		
			from report_receipt where receipt_day=to_char(sysdate-1,'yyyymmdd') 
		    and region_id=#{areaCode}
		    AND REPORT_TYPE=#{basScod}
		    
		    and individual_id is null
			
		),
		oth as
		(
		    select a.*  from 
		    (select receipt_id ,individual_id ,INDIVIDUAL_TYPE,report_type,region_id
		    ,FLAG_SEND ,FLAG_IMPORTANT ,FLAG_BROD ,BROAD_TIME		
		    from report_receipt where receipt_day=to_char(sysdate-1,'yyyymmdd') 
		    and region_id=#{areaCode}
		    AND REPORT_TYPE=#{basScod}
		    )a
		    left join
		    (select informer_id,area_code from informer)b
		    on(a.individual_id=b.informer_id)
		    where a.region_id!=b.area_code
		)
		select 
		to_char(sysdate-1,'yyyymmdd')
		,#{areaCode}
		,#{basScod}
		,(select count(receipt_id) from our) 
		,(select count(receipt_id) from our where flag_send='Y') 
		,(select count(receipt_id) from our where flag_send='N') 
		,(select count(receipt_id) from our where flag_brod!='N') 
		,(select count(receipt_id) from our where flag_brod='Y') 
		,(select count(receipt_id) from our where flag_brod='C') 
		,(select count(receipt_id) from our where flag_brod='N' and flag_send='Y')
		,(select count(receipt_id) from our where flag_important='Y') 
		,(select count(receipt_id) from our where flag_important='N')
		,(select count(receipt_id) from our where flag_important='Y' and flag_brod!='N') 
		,(select count(receipt_id) from our where flag_important='Y' and flag_brod='Y') 
		,(select count(receipt_id) from our where flag_important='Y' and flag_brod='C') 
		,(select count(receipt_id) from oth) 
		,(select count(receipt_id) from oth where flag_send='Y') 
		,(select count(receipt_id) from oth where flag_send='N') 
		,(select count(receipt_id) from oth where flag_brod!='N')
		,(select count(receipt_id) from oth where flag_brod='Y') 
		,(select count(receipt_id) from oth where flag_brod='C') 
		,(select count(receipt_id) from oth where flag_brod='N' and flag_send='Y') 
		,(select count(receipt_id) from oth where flag_important='Y')
		,(select count(receipt_id) from oth where flag_important='N') 
		,(select count(receipt_id) from oth where flag_important='Y' and flag_brod!='N') 
		,(select count(receipt_id) from oth where flag_important='Y' and flag_brod='Y') 
		,(select count(receipt_id) from oth where flag_important='Y' and flag_brod='C') 
		from dual
	</insert>
	
	<!-- 제보수단별 제보통계 테이블 쿼리 -->
	<insert id="statRttType" parameterType="java.lang.String" >
		INSERT INTO STAT_RTT_TYPE
		(
		STAT_DATE
		,REGION_ID
		,REPORTMEAN_TYPE
		
		,ALL_CNT
		,SEND_Y
		,SEND_N
		
		,BROAD_Y
		,BROAD_P
		,BROAD_C
		,BROAD_N
		
		,IMP_Y
		,IMP_N
		
		,IMPBRO_Y
		,IMPBRO_P
		,IMPBRO_C
		
		,O_ALL_CNT
		,O_SEND_Y
		,O_SEND_N
		
		,O_BROAD_Y
		,O_BROAD_P
		,O_BROAD_C
		,O_BROAD_N
		
		,O_IMP_Y
		,O_IMP_N
		,O_IMPBRO_Y
		,O_IMPBRO_P
		,O_IMPBRO_C
		)
		
		with our as
		(
			select a.* from 
			(select receipt_id ,individual_id ,INDIVIDUAL_TYPE,report_type,region_id
			,FLAG_SEND ,FLAG_IMPORTANT ,FLAG_BROD ,BROAD_TIME		
			from report_receipt where receipt_day=to_char(sysdate-1,'yyyymmdd') 
		    and region_id=#{areaCode}
		    AND REPORTER_TYPE=#{ifmId1}
			)a
			left join
			(select informer_id,area_code from informer)b
			on(a.individual_id=b.informer_id)
			where a.region_id=b.area_code
			
			<!-- 통신원 id가 null인 통신원은 시민임 -->
			union all
			
			select receipt_id ,individual_id ,INDIVIDUAL_TYPE,report_type,region_id
			,FLAG_SEND ,FLAG_IMPORTANT ,FLAG_BROD ,BROAD_TIME		
			from report_receipt where receipt_day=to_char(sysdate-1,'yyyymmdd') 
		    and region_id=#{areaCode}
		    AND REPORTER_TYPE=#{ifmId1}
		    
		    and individual_id is null
			
		),
		oth as
		(
		    select a.* from 
		    (select receipt_id ,individual_id ,INDIVIDUAL_TYPE,report_type,region_id
		    ,FLAG_SEND ,FLAG_IMPORTANT ,FLAG_BROD ,BROAD_TIME		
		    from report_receipt where receipt_day=to_char(sysdate-1,'yyyymmdd') 
		    and region_id=#{areaCode}
		    AND REPORTER_TYPE=#{ifmId1}
		    )a
		    left join
		    (select informer_id,area_code from informer)b
		    on(a.individual_id=b.informer_id)
		    where a.region_id!=b.area_code
		)
		select 
		to_char(sysdate-1,'yyyymmdd')
		,#{areaCode}
		,#{ifmId1}
		,(select count(receipt_id) from our) 
		,(select count(receipt_id) from our where flag_send='Y') 
		,(select count(receipt_id) from our where flag_send='N') 
		,(select count(receipt_id) from our where flag_brod!='N') 
		,(select count(receipt_id) from our where flag_brod='Y') 
		,(select count(receipt_id) from our where flag_brod='C') 
		,(select count(receipt_id) from our where flag_brod='N' and flag_send='Y')
		,(select count(receipt_id) from our where flag_important='Y') 
		,(select count(receipt_id) from our where flag_important='N')
		,(select count(receipt_id) from our where flag_important='Y' and flag_brod!='N') 
		,(select count(receipt_id) from our where flag_important='Y' and flag_brod='Y') 
		,(select count(receipt_id) from our where flag_important='Y' and flag_brod='C') 
		,(select count(receipt_id) from oth) 
		,(select count(receipt_id) from oth where flag_send='Y') 
		,(select count(receipt_id) from oth where flag_send='N') 
		,(select count(receipt_id) from oth where flag_brod!='N')
		,(select count(receipt_id) from oth where flag_brod='Y') 
		,(select count(receipt_id) from oth where flag_brod='C') 
		,(select count(receipt_id) from oth where flag_brod='N' and flag_send='Y') 
		,(select count(receipt_id) from oth where flag_important='Y')
		,(select count(receipt_id) from oth where flag_important='N') 
		,(select count(receipt_id) from oth where flag_important='Y' and flag_brod!='N') 
		,(select count(receipt_id) from oth where flag_important='Y' and flag_brod='Y') 
		,(select count(receipt_id) from oth where flag_important='Y' and flag_brod='C') 
		from dual
	</insert>
	
	<!-- 월별 통신원 건수 기존 것 삭제 후 갱신  (임시)(adsoft 미사용시 제거 필요) -->
	<delete id="schmonInfrmDelete" parameterType="userVO">
		DELETE FROM stat_tbn_monrpt 
		where stat_mon = to_char(sysdate-1,'yyyymm')
	</delete>
	
	<!-- 월별 통신원별 제보건수 저장 (임시)(adsoft 미사용시 제거 필요) -->
	<insert id="schmonInfrmInsert" parameterType="java.lang.String" >
	    INSERT INTO STAT_TBN_MONRPT
		select 
		to_char(sysdate-1,'yyyymm') as stat_mon,a.ind_id,a.org_id,a.ind_type,nvl(b.mon_cnt,0) as mon_cnt
		,nvl(d.main_cnt,0) as main_cnt
		<!-- add cnt 가 증감건수에서 전월건수로 변경 -->
		,nvl(c.bf_cnt,0) as add_cnt
		,a.area_code,0 as eva_cnt
		from
		<!-- 통신원 -->
		(
		    select informer_id as ind_id, org_id,informer_type as ind_type,area_code from informer
		    where flag_act='Y'
		)a
		<!-- 현재달 -->
		left join
		(
		    select individual_id , count(individual_id) as mon_cnt 
		    from report_receipt 
		    where receipt_day <![CDATA[>=]]> TRUNC(SYSDATE-1, 'MM') and receipt_day <![CDATA[<=]]> last_day(SYSDATE-1)
		    group by individual_id
		)b
		ON (a.ind_id = b.individual_id)
		<!-- 전달 (증감건수) -->
		left join
		(
		    select individual_id , count(individual_id) as bf_cnt
		    from report_receipt 
		    where receipt_day <![CDATA[>=]]> TRUNC(SYSDATE-1, 'MM') and receipt_day <![CDATA[<=]]> last_day(SYSDATE-1)
		    group by individual_id
		)c
		ON (a.ind_id = c.individual_id)
		<!-- 현재 달 (중요제보) -->
		left join
		(
		    select individual_id , count(individual_id) as main_cnt
		    from report_receipt 
		    where receipt_day <![CDATA[>=]]> TRUNC(SYSDATE-1, 'MM') and receipt_day <![CDATA[<=]]> last_day(SYSDATE-1)
		    and REPORT_TYPE NOT IN('A00','A01','A05','A07','A08')
		    group by individual_id
		)d
		ON (a.ind_id = d.individual_id)

	</insert>
	
	<!-- 금일접수현황 엑셀 다운로드 -->
	<select id="searchStatusListToday" parameterType="searchVO" resultType="record">
		SELECT *
		FROM(SELECT ROWNUM AS SEQ, H.*
		    FROM(SELECT ROW_NUMBER() OVER(ORDER BY RECEIPT_DT ASC) AS RNUM, G.*
		        FROM(
				SELECT A.RECEIPT_ID
					, TO_CHAR(A.RECEIPT_DAY,'YYYY-MM-DD') AS RECEIPT_DAY
					, A.RECEIPT_DAY||A.RECEIPT_TIME AS RECEIPT_DT
					, A.FLAG_SEND 
					, A.FLAG_BROD 
					, DECODE(A.X_COORDINATE , '' , 'N' , 'Y') AS FLAG_MAP  
					, TO_CHAR(TO_DATE(A.RECEIPT_TIME , 'HH24MI') , 'HH24:MI') AS RECEIPT_TIME
					, C.BAS_NAME AS REPORT_TYPE
					, C.F_COLOR
					, C.B_COLOR
					, D.BAS_NAME AS REPORT_TYPE2
					, A.INDIVIDUAL_ID
					, A.INDIVIDUAL_NAME
					, B.TYPE_NAME
					, A.RECEPTION_ID
					, A.RECEPTION_NAME
					, A.MEMO
					, E.NAME AS REPORTER_TYPE
					, F.AREA_NAME AS REGION_NAME
					, A.FLAG_IMPORTANT
					, TO_CHAR(TO_DATE(A.BROAD_TIME,'YYYYMMDDHH24MISS'),'HH24:MI') AS BROAD_TIME
		            FROM 
		            (
		            	SELECT * FROM REPORT_RECEIPT_TODAY
		            	WHERE 1 = 1
						<if test="!REPORT_TYPE.equals('') and REPORT_TYPE != null">
							AND REPORT_TYPE = #{REPORT_TYPE}
						</if>
						<if test="!REPORT_TYPE2.equals('') and REPORT_TYPE2 != null">
							AND REPORT_TYPE2 = #{REPORT_TYPE2}
						</if>
						<if test="!REPORTMEAN_TYPE.equals('') and REPORTMEAN_TYPE != null">
							AND REPORTER_TYPE = #{REPORTMEAN_TYPE}
						</if>
						<if test="!FLAG_SEND.equals('') and FLAG_SEND != null">
							AND FLAG_SEND = #{FLAG_SEND}
						</if>
						<if test="!FLAG_BROD.equals('') and FLAG_BROD != null">
							AND FLAG_BROD = #{FLAG_BROD}
						</if>
						<if test="!AREA_CODE.equals('') and AREA_CODE != null">
							AND REGION_ID = #{AREA_CODE}
						</if>
						<if test="!START_DAY.equals('') and START_DAY != null and !END_DAY.equals('') and END_DAY != null">
							AND RECEIPT_DAY BETWEEN TO_CHAR(TO_DATE(#{START_DAY}, 'YYYY-MM-DD'), 'YYYYMMDD')
											    AND TO_CHAR(TO_DATE(#{END_DAY}, 'YYYY-MM-DD'), 'YYYYMMDD')
						</if>
						<if test="!FLAG_IMPORTANT.equals('') and FLAG_IMPORTANT != null">
							<if test='FLAG_IMPORTANT.equals("N")'>
	                            <![CDATA[AND FLAG_IMPORTANT = 'N']]>
	                        </if>
	                    	<if test='FLAG_IMPORTANT.equals("Y")'>
	                    	    <![CDATA[AND FLAG_IMPORTANT <> 'N']]>
	                    	</if>
						</if>
				<!-- 시간대별 검색 -->
				<if test="!RECEIPT_TIME.equals('') and RECEIPT_TIME != null">
					AND RECEIPT_TIME LIKE #{RECEIPT_TIME}||'%'
				</if>
				<if test="!RECEPTION_NAME.equals('') and RECEPTION_NAME != null">
					AND RECEPTION_NAME LIKE '%'||#{RECEPTION_NAME}||'%'
				</if>
				<if test="!INDIVIDUAL_NAME.equals('') and INDIVIDUAL_NAME != null">
					AND INDIVIDUAL_NAME LIKE '%'||#{INDIVIDUAL_NAME}||'%'
				</if>
				
				<choose>
					<when test="rcptAndOr.equals('AND')">
					    <choose>
					        <when test="!CONTENT1.equals('') and CONTENT1 != null and !CONTENT2.equals('') and CONTENT2 != null">
						   		AND MEMO LIKE '%'||#{CONTENT1}||'%' AND MEMO LIKE '%'||#{CONTENT2}||'%'
							</when>
							<otherwise>
							    <if test="!CONTENT1.equals('') and CONTENT1 != null">
									AND MEMO LIKE '%'||#{CONTENT1}||'%'
								</if>
							    <if test="!CONTENT2.equals('') and CONTENT2 != null">
									AND MEMO LIKE '%'||#{CONTENT2}||'%'
								</if>
							</otherwise>
					    </choose>
					</when>
					<otherwise>
					    <choose>
					        <when test="!CONTENT1.equals('') and CONTENT1 != null and !CONTENT2.equals('') and CONTENT2 != null">
							    and 
							    (
									MEMO LIKE '%'||#{CONTENT1}||'%'
							    	or
									MEMO LIKE '%'||#{CONTENT2}||'%'
								)
							</when>
							<otherwise>
							    <if test="!CONTENT1.equals('') and CONTENT1 != null">
									AND MEMO LIKE '%'||#{CONTENT1}||'%'
								</if>
							    <if test="!CONTENT2.equals('') and CONTENT2 != null">
									AND MEMO LIKE '%'||#{CONTENT2}||'%'
								</if>
							</otherwise>
					    </choose>
					</otherwise>    
				</choose>
					) A
	                LEFT OUTER JOIN CODE_INFORMER_TYPE B
	                    ON A.INDIVIDUAL_TYPE = B.TYPE_ID
	                LEFT OUTER JOIN 
	                (SELECT * FROM CODE_REPORT_TYPE WHERE BAS_LCOD='100') C
	                    ON A.REPORT_TYPE = C.BAS_SCOD
	                LEFT OUTER JOIN CODE_REPORT_TYPE D
	                    ON D.BAS_SCOD = A.REPORT_TYPE2
	                    AND D.BAS_LCOD = A.REPORT_TYPE
	                LEFT OUTER JOIN CODE_REPORTMEAN_TYPE E
			                ON A.REPORTER_TYPE = E.ID
		            LEFT OUTER JOIN CODE_AREACODE F
		                ON A.REGION_ID = F.AREA_CODE
	            ) G
	            ORDER BY RNUM DESC
	        ) H
	    )
	</select>    
	
	<!-- 전체접수현황 엑셀 다운로드 -->
	<select id="searchStatusList" parameterType="searchVO" resultType="record">
		SELECT *
		FROM(SELECT ROWNUM AS SEQ, H.*
		    FROM(SELECT ROW_NUMBER() OVER(ORDER BY RECEIPT_DT ASC) AS RNUM, G.*
		        FROM(
				SELECT A.RECEIPT_ID
					, TO_CHAR(A.RECEIPT_DAY,'YYYY-MM-DD') AS RECEIPT_DAY
					, A.RECEIPT_DAY||A.RECEIPT_TIME AS RECEIPT_DT
					, A.FLAG_SEND 
					, A.FLAG_BROD 
					, DECODE(A.X_COORDINATE , '' , 'N' , 'Y') AS FLAG_MAP  
					, TO_CHAR(TO_DATE(A.RECEIPT_TIME , 'HH24MI') , 'HH24:MI') AS RECEIPT_TIME
					, C.BAS_NAME AS REPORT_TYPE
					, C.F_COLOR
					, C.B_COLOR
					, D.BAS_NAME AS REPORT_TYPE2
					, A.INDIVIDUAL_ID
					, A.INDIVIDUAL_NAME
					, B.TYPE_NAME
					, A.RECEPTION_ID
					, A.RECEPTION_NAME
					, A.MEMO
					, E.NAME AS REPORTER_TYPE
					, F.AREA_NAME AS REGION_NAME
					, A.FLAG_IMPORTANT
					, TO_CHAR(TO_DATE(A.BROAD_TIME,'YYYYMMDDHH24MISS'),'HH24:MI') AS BROAD_TIME
		            FROM 
		            (
		            	SELECT * FROM REPORT_RECEIPT 
		            	WHERE 1 = 1
						<if test="!REPORT_TYPE.equals('') and REPORT_TYPE != null">
							AND REPORT_TYPE = #{REPORT_TYPE}
						</if>
						<if test="!REPORT_TYPE2.equals('') and REPORT_TYPE2 != null">
							AND REPORT_TYPE2 = #{REPORT_TYPE2}
						</if>
						<if test="!REPORTMEAN_TYPE.equals('') and REPORTMEAN_TYPE != null">
							AND REPORTER_TYPE = #{REPORTMEAN_TYPE}
						</if>
						<if test="!FLAG_SEND.equals('') and FLAG_SEND != null">
							AND FLAG_SEND = #{FLAG_SEND}
						</if>
						<if test="!FLAG_BROD.equals('') and FLAG_BROD != null">
							AND FLAG_BROD = #{FLAG_BROD}
						</if>
						<if test="!AREA_CODE.equals('') and AREA_CODE != null">
							AND REGION_ID = #{AREA_CODE}
						</if>
						<if test="!START_DAY.equals('') and START_DAY != null and !END_DAY.equals('') and END_DAY != null">
							AND RECEIPT_DAY BETWEEN TO_CHAR(TO_DATE(#{START_DAY}, 'YYYY-MM-DD'), 'YYYYMMDD')
											    AND TO_CHAR(TO_DATE(#{END_DAY}, 'YYYY-MM-DD'), 'YYYYMMDD')
						</if>
						<if test="!FLAG_IMPORTANT.equals('') and FLAG_IMPORTANT != null">
							<if test='FLAG_IMPORTANT.equals("N")'>
	                            <![CDATA[AND FLAG_IMPORTANT = 'N']]>
	                        </if>
	                    	<if test='FLAG_IMPORTANT.equals("Y")'>
	                    	    <![CDATA[AND FLAG_IMPORTANT <> 'N']]>
	                    	</if>
						</if>
				<!-- 시간대별 검색 -->
				<if test="!RECEIPT_TIME.equals('') and RECEIPT_TIME != null">
					AND RECEIPT_TIME LIKE #{RECEIPT_TIME}||'%'
				</if>
				<if test="!RECEPTION_NAME.equals('') and RECEPTION_NAME != null">
					AND RECEPTION_NAME LIKE '%'||#{RECEPTION_NAME}||'%'
				</if>
				<if test="!INDIVIDUAL_NAME.equals('') and INDIVIDUAL_NAME != null">
					AND INDIVIDUAL_NAME LIKE '%'||#{INDIVIDUAL_NAME}||'%'
				</if>
				
				<choose>
					<when test="rcptAndOr.equals('AND')">
					    <choose>
					        <when test="!CONTENT1.equals('') and CONTENT1 != null and !CONTENT2.equals('') and CONTENT2 != null">
						   		AND MEMO LIKE '%'||#{CONTENT1}||'%' AND MEMO LIKE '%'||#{CONTENT2}||'%'
							</when>
							<otherwise>
							    <if test="!CONTENT1.equals('') and CONTENT1 != null">
									AND MEMO LIKE '%'||#{CONTENT1}||'%'
								</if>
							    <if test="!CONTENT2.equals('') and CONTENT2 != null">
									AND MEMO LIKE '%'||#{CONTENT2}||'%'
								</if>
							</otherwise>
					    </choose>
					</when>
					<otherwise>
					    <choose>
					        <when test="!CONTENT1.equals('') and CONTENT1 != null and !CONTENT2.equals('') and CONTENT2 != null">
							    and 
							    (
									MEMO LIKE '%'||#{CONTENT1}||'%'
							    	or
									MEMO LIKE '%'||#{CONTENT2}||'%'
								)
							</when>
							<otherwise>
							    <if test="!CONTENT1.equals('') and CONTENT1 != null">
									AND MEMO LIKE '%'||#{CONTENT1}||'%'
								</if>
							    <if test="!CONTENT2.equals('') and CONTENT2 != null">
									AND MEMO LIKE '%'||#{CONTENT2}||'%'
								</if>
							</otherwise>
					    </choose>
					</otherwise>    
				</choose>
					) A
	                LEFT OUTER JOIN CODE_INFORMER_TYPE B
	                    ON A.INDIVIDUAL_TYPE = B.TYPE_ID
	                LEFT OUTER JOIN 
	                (SELECT * FROM CODE_REPORT_TYPE WHERE BAS_LCOD='100') C
	                    ON A.REPORT_TYPE = C.BAS_SCOD
	                LEFT OUTER JOIN CODE_REPORT_TYPE D
	                    ON D.BAS_SCOD = A.REPORT_TYPE2
	                    AND D.BAS_LCOD = A.REPORT_TYPE
	                LEFT OUTER JOIN CODE_REPORTMEAN_TYPE E
			                ON A.REPORTER_TYPE = E.ID
		            LEFT OUTER JOIN CODE_AREACODE F
		                ON A.REGION_ID = F.AREA_CODE
	            ) G
	            ORDER BY RNUM DESC
	        ) H
	    )
	</select>    
	
	<!-- 통신원중소분류 가변 날짜 처리법	 -->
	<select id="statDateCal" parameterType="params" resultType="record">
	    <![CDATA[
			SELECT 'date_'||stat_mon as key_date,stat_mon FROM STAT_TBN_MONRPT
			WHERE stat_mon >= SUBSTR(#{orgStartDate},0,6) 
			AND stat_mon <= SUBSTR(#{orgEndDate},0,6) 
			GROUP BY stat_mon
			order by stat_mon
		]]> 
	</select>	
	
	<!-- 통신원 중/소 분류별 통계 -->
	<select id="orgOrgSub" parameterType="params" resultType="record">
		SELECT
			 A.ACT_ID
			,A.INFORMER_NAME
	        ,A.PHONE_CELL
	        ,A.ORG_NAME
	        ,A.ORG_SNAME
	        ,A.BIRTHDAY
			,NVL(
                <foreach collection="chkArr" item="item" index="i" separator="+">
                   "${item.KEY_DATE}"
               </foreach>
			<!-- t1+t2+t3+t4+t5+t6+t7+t8+t9+t10+t11+t12+t13+t14+t15+t16+t17+t18+t19+t20+t21+t22+t23+t24+t25+t26+t27+t28+t29+t30+t31 -->
			,0) AS SUM_CNT
			,
			<foreach collection="chkArr" item="item" index="i" separator=",">
                NVL("${item.KEY_DATE}",0) as "${item.KEY_DATE}"
            </foreach>
			
	        <!-- ,NVL(t1,0) AS D1	,NVL(t2,0) AS D2	,NVL(t3,0) AS D3	,NVL(t4,0) AS D4	,NVL(t5,0) AS D5	,NVL(t6,0) AS D6	,NVL(t7,0) AS D7	,NVL(t8,0) AS D8	,NVL(t9,0) AS D9	,NVL(t10,0) AS D10	,NVL(t11,0) AS D11	,NVL(t12,0) AS D12	,NVL(t13,0) AS D13	,NVL(t14,0) AS D14	,NVL(t15,0) AS D15	,NVL(t16,0) AS D16	,NVL(t17,0) AS D17	,NVL(t18,0) AS D18	,NVL(t19,0) AS D19	,NVL(t20,0) AS D20	,NVL(t21,0) AS D21	,NVL(t22,0) AS D22	,NVL(t23,0) AS D23	,NVL(t24,0) AS D24	,NVL(t25,0) AS D25	,NVL(t26,0) AS D26	,NVL(t27,0) AS D27	,NVL(t28,0) AS D28	,NVL(t29,0) AS D29	,NVL(t30,0) AS D30	,NVL(t31,0) AS D31 -->
		from
		(
		    SELECT 
		         A.informer_id
		        ,A.act_id
		        ,A.informer_name
		        ,A.phone_cell
		        ,A.BIRTHDAY
		        ,B.org_id
		        ,NVL(B.org_name,'정보없음')AS ORG_NAME
		        ,C.ORG_SID
		        ,NVL(C.org_sname,'정보없음')AS ORG_SNAME
		    FROM
		    INFORMER A
		    LEFT JOIN
		    organization B
		    ON A.ORG_ID = B.ORG_ID
		    AND A.INFORMER_TYPE = B.IND_TYPE
		    AND A.AREA_CODE=B.AREA_CODE
		    LEFT JOIN
		    ORG_SUB C
		    ON B.ORG_ID = C.ORG_ID 
		    AND B.IND_TYPE = C.IND_TYPE 
		    AND B.AREA_CODE = C.AREA_CODE
		    AND A.ORG_SUB_ID=C.ORG_SID
		    where A.area_code=#{params.REGION_ID}
            AND A.FLAG_ACT ='Y'
		)A
		left join
		(
            SELECT * FROM(
                select to_char(receipt_day,'yyyymm') as receipt_day,individual_id from report_receipt
                        where receipt_day <![CDATA[>=]]> #{orgStartDate}
                        and receipt_day <![CDATA[<=]]> #{orgEndDate}
                        and region_id=#{params.REGION_ID}
                        and individual_id is not null
            )
            
            PIVOT(
                COUNT(*)
                FOR receipt_day in 
                (
                
                <foreach collection="chkArr" item="item" index="i" separator=",">
                    '${item.STAT_MON}' as "${item.KEY_DATE}"
                </foreach>
<!--                  1 as t1 	
                 ,2 as t2 	,3 as t3 	,4 as t4 	,5 as t5 	,6 as t6 	,7 as t7 	,8 as t8 	,9 as t9 	,10 as t10 	,11 as t11 	,12 as t12 	,13 as t13 	,14 as t14 	,15 as t15 	,16 as t16 	,17 as t17 	,18 as t18 	,19 as t19 	,20 as t20 	,21 as t21 	,22 as t22 	,23 as t23 	,24 as t24 	,25 as t25 	,26 as t26 	,27 as t27 	,28 as t28 	,29 as t29 	,30 as t30 	,31 as t31 
 -->                
 				)
            )          
		)B
		on(A.informer_id=B.individual_id)
		order by TO_NUMBER(ACT_ID) ASC 
	</select>
	
</mapper>